# Top-level Makefile for UADE

MAKE = {MAKE}

FINALBINDIR = {BINDIR}
FINALDATADIR = {DATADIR}
FINALDOCDIR = {DOCDIR}
FINALMANDIR = {MANDIR}
FINALLIBDIR = {LIBDIR}

BINDIR = {PACKAGEPREFIX}{BINDIR}
DATADIR = {PACKAGEPREFIX}{DATADIR}
DOCDIR = {PACKAGEPREFIX}{DOCDIR}
MANDIR = {PACKAGEPREFIX}{MANDIR}
LIBDIR = {PACKAGEPREFIX}{LIBDIR}
XMMSPLUGINDIR= {PACKAGEPREFIX}{XMMSPLUGINDIR}
AUDACIOUSPLUGINDIR= {PACKAGEPREFIX}{AUDACIOUSPLUGINDIR}
PKGCONFIGDIR = {PACKAGEPREFIX}{PKGCONFIGDIR}

UADECORE={UADECORE}
UADECORENAME={UADECORENAME}
UADECOREINSTALL={UADECOREINSTALL}
UADE123={UADE123}
UADE123NAME={UADE123NAME}
UADE123INSTALL={UADE123INSTALL}
XMMSPLUGIN={XMMSPLUGIN}
XMMSPLUGININSTALL={XMMSPLUGININSTALL}
AUDACIOUSPLUGIN={AUDACIOUSPLUGIN}
AUDACIOUSPLUGININSTALL={AUDACIOUSPLUGININSTALL}

all:	src/include/uadeconfig.h $(UADECORE) $(UADE123) $(XMMSPLUGIN) $(AUDACIOUSPLUGIN)

uadecore:	
	$(MAKE) -C src

uadecoreinstall:	$(UADECORE)
	mkdir -p "$(LIBDIR)" "$(PKGCONFIGDIR)"
	chmod og+rx "$(LIBDIR)"
	cp -f src/$(UADECORENAME) "$(LIBDIR)"/
	chmod og+rx "$(LIBDIR)/$(UADECORENAME)"
	install uade.pc $(PKGCONFIGDIR)/
	chmod og+rx $(PKGCONFIGDIR)
	chmod 644 $(PKGCONFIGDIR)/uade.pc

uade123:	
	$(MAKE) -C src/frontends/uade123

uade123install:	
	$(MAKE) -C src/frontends/uade123 install

xmmsplugin:	
	$(MAKE) -C src/frontends/xmms

xmmsplugininstall:	$(XMMSPLUGIN)
	mkdir -p "$(XMMSPLUGINDIR)" "$(BINDIR)"
	install src/frontends/xmms/libuade2.so "$(XMMSPLUGINDIR)"
	install contrib/uadexmmsadd "$(BINDIR)"/

audaciousplugin:	
	$(MAKE) -C src/frontends/audacious

audaciousplugininstall:	$(AUDACIOUSPLUGIN)
	$(MAKE) -C src/frontends/audacious install

src/include/uadeconfig.h:	
	@echo ""
	@echo "Run ./configure first!"
	@echo ""
	@false

soundcheck:	
	@ echo ""
	@ echo "### UADE should be playing now 'AHX.Cruisin'"
	@ echo ""
	src/frontends/uade123/$(UADE123NAME) --basedir=. -S amigasrc/score/score -P players/AbyssHighestExperience -m songs/AHX.Cruisin -u src/uadecore

install:	
	mkdir -p "$(DATADIR)/players"
	test -e "$(DATADIR)/uade.conf" || cp -f uade.conf "$(DATADIR)/"
	cp -f amigasrc/score/score uaerc eagleplayer.conf "$(DATADIR)/"
	cp -rf players "$(DATADIR)/" || true
	chmod -R og+rX "$(DATADIR)"
	$(MAKE) installagain
	$(MAKE) feinstall
	install src/frontends/mod2ogg/mod2ogg2.sh "$(BINDIR)/"
	cp doc/uade123.1 "$(MANDIR)"/
	chmod og+r "$(MANDIR)"/uade123.1

uninstall:	
# Don't remove everything
	for name in players score ; do rm -rf -- "$(DATADIR)/$$name" ; done
	rm -f "$(MANDIR)"/uade123.1
	rm -f "$(LIBDIR)/$(UADECORENAME)"

installagain:	$(UADECOREINSTALL)
	@true

feinstall:	$(UADE123INSTALL) $(XMMSPLUGININSTALL) $(AUDACIOUSPLUGININSTALL)
	@true

feclean:	
	$(MAKE) -C src/frontends/uade123 clean
	$(MAKE) -C src/frontends/xmms clean
	$(MAKE) -C src/frontends/audacious clean

clean:	
	$(MAKE) -C src clean
	$(MAKE) feclean
